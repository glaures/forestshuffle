import{c as _}from"./hookable-B8xFkYCm.js";import{D as k,I as P,d as c,t as C,a as g,H as E,N as h,h as y,S as w,p as m,r as v,n as x}from"./@unhead-7sNLY-vF.js";const M=["templateParams","htmlAttrs","bodyAttrs"],I=c({hooks:{"tag:normalise":function({tag:o}){["hid","vmid","key"].forEach(e=>{o.props[e]&&(o.key=o.props[e],delete o.props[e])});const s=C(o)||(o.key?`${o.tag}:${o.key}`:!1);s&&(o._d=s)},"tags:resolve":function(o){const t={};o.tags.forEach(e=>{const i=(e.key?`${e.tag}:${e.key}`:e._d)||e._p,a=t[i];if(a){let l=e==null?void 0:e.tagDuplicateStrategy;if(!l&&M.includes(e.tag)&&(l="merge"),l==="merge"){const n=a.props;["class","style"].forEach(r=>{n[r]&&(e.props[r]?(r==="style"&&!n[r].endsWith(";")&&(n[r]+=";"),e.props[r]=`${n[r]} ${e.props[r]}`):e.props[r]=n[r])}),t[i].props={...n,...e.props};return}else if(e._e===a._e){a._duped=a._duped||[],e._d=`${a._d}:${a._duped.length+1}`,a._duped.push(e);return}else if(g(e)>g(a))return}const p=Object.keys(e.props).length+(e.innerHTML?1:0)+(e.textContent?1:0);if(E.includes(e.tag)&&p===0){delete t[i];return}t[i]=e});const s=[];Object.values(t).forEach(e=>{const i=e._duped;delete e._duped,s.push(e),i&&s.push(...i)}),o.tags=s,o.tags=o.tags.filter(e=>!(e.tag==="meta"&&(e.props.name||e.props.property)&&!e.props.content))}}}),b=c({mode:"server",hooks:{"tags:resolve":function(o){const t={};o.tags.filter(s=>["titleTemplate","templateParams","title"].includes(s.tag)&&s._m==="server").forEach(s=>{t[s.tag]=s.tag.startsWith("title")?s.textContent:s.props}),Object.keys(t).length&&o.tags.push({tag:"script",innerHTML:JSON.stringify(t),props:{id:"unhead:payload",type:"application/json"}})}}}),L=["script","link","bodyAttrs"],S=c(o=>({hooks:{"tags:resolve":function(t){for(const s of t.tags.filter(e=>L.includes(e.tag)))Object.entries(s.props).forEach(([e,i])=>{e.startsWith("on")&&typeof i=="function"&&(o.ssr&&h.includes(e)?s.props[e]=`this.dataset.${e}fired = true`:delete s.props[e],s._eventHandlers=s._eventHandlers||{},s._eventHandlers[e]=i)}),o.ssr&&s._eventHandlers&&(s.props.src||s.props.href)&&(s.key=s.key||y(s.props.src||s.props.href))},"dom:renderTag":function({$el:t,tag:s}){var e,i;for(const a of Object.keys((t==null?void 0:t.dataset)||{}).filter(p=>h.some(l=>`${l}fired`===p))){const p=a.replace("fired","");(i=(e=s._eventHandlers)==null?void 0:e[p])==null||i.call(t,new Event(p.replace("on","")))}}}})),j=["link","style","script","noscript"],$=c({hooks:{"tag:normalise":({tag:o})=>{o.key&&j.includes(o.tag)&&(o.props["data-hid"]=o._h=y(o.key))}}}),A=c({hooks:{"tags:resolve":o=>{const t=s=>{var e;return(e=o.tags.find(i=>i._d===s))==null?void 0:e._p};for(const{prefix:s,offset:e}of w)for(const i of o.tags.filter(a=>typeof a.tagPriority=="string"&&a.tagPriority.startsWith(s))){const a=t(i.tagPriority.replace(s,""));typeof a<"u"&&(i._p=a+e)}o.tags.sort((s,e)=>s._p-e._p).sort((s,e)=>g(s)-g(e))}}}),D={meta:"content",link:"href",htmlAttrs:"lang"},K=c(o=>({hooks:{"tags:resolve":t=>{var l;const{tags:s}=t,e=(l=s.find(n=>n.tag==="title"))==null?void 0:l.textContent,i=s.findIndex(n=>n.tag==="templateParams"),a=i!==-1?s[i].props:{},p=a.separator||"|";delete a.separator,a.pageTitle=m(a.pageTitle||e||"",a,p);for(const n of s.filter(r=>r.processTemplateParams!==!1)){const r=D[n.tag];r&&typeof n.props[r]=="string"?n.props[r]=m(n.props[r],a,p):(n.processTemplateParams===!0||["titleTemplate","title"].includes(n.tag))&&["innerHTML","textContent"].forEach(d=>{typeof n[d]=="string"&&(n[d]=m(n[d],a,p))})}o._templateParams=a,o._separator=p,t.tags=s.filter(n=>n.tag!=="templateParams")}}})),W=c({hooks:{"tags:resolve":o=>{const{tags:t}=o;let s=t.findIndex(i=>i.tag==="titleTemplate");const e=t.findIndex(i=>i.tag==="title");if(e!==-1&&s!==-1){const i=v(t[s].textContent,t[e].textContent);i!==null?t[e].textContent=i||t[e].textContent:delete t[e]}else if(s!==-1){const i=v(t[s].textContent);i!==null&&(t[s].textContent=i,t[s].tag="title",s=-1)}s!==-1&&delete t[s],o.tags=t.filter(Boolean)}}}),O=c({hooks:{"tags:afterResolve":function(o){for(const t of o.tags)typeof t.innerHTML=="string"&&(t.innerHTML&&["application/ld+json","application/json"].includes(t.props.type)?t.innerHTML=t.innerHTML.replace(/</g,"\\u003C"):t.innerHTML=t.innerHTML.replace(new RegExp(`</${t.tag}`,"g"),`<\\/${t.tag}`))}}});let T;function F(o={}){const t=R(o);return t.use(k()),T=t}function H(o,t){return!o||o==="server"&&t||o==="client"&&!t}function R(o={}){const t=_();t.addHooks(o.hooks||{}),o.document=o.document||(P?document:void 0);const s=!o.document,e=()=>{l.dirty=!0,t.callHook("entries:updated",l)};let i=0,a=[];const p=[],l={plugins:p,dirty:!1,resolvedOptions:o,hooks:t,headEntries(){return a},use(n){const r=typeof n=="function"?n(l):n;(!r.key||!p.some(d=>d.key===r.key))&&(p.push(r),H(r.mode,s)&&t.addHooks(r.hooks||{}))},push(n,r){r==null||delete r.head;const d={_i:i++,input:n,...r};return H(d.mode,s)&&(a.push(d),e()),{dispose(){a=a.filter(u=>u._i!==d._i),t.callHook("entries:updated",l),e()},patch(u){a=a.map(f=>(f._i===d._i&&(f.input=d.input=u),f)),e()}}},async resolveTags(){const n={tags:[],entries:[...a]};await t.callHook("entries:resolve",n);for(const r of n.entries){const d=r.resolvedInput||r.input;if(r.resolvedInput=await(r.transform?r.transform(d):d),r.resolvedInput)for(const u of await x(r)){const f={tag:u,entry:r,resolvedOptions:l.resolvedOptions};await t.callHook("tag:normalise",f),n.tags.push(f.tag)}}return await t.callHook("tags:beforeResolve",n),await t.callHook("tags:resolve",n),await t.callHook("tags:afterResolve",n),n.tags},ssr:s};return[I,b,S,$,A,K,W,O,...(o==null?void 0:o.plugins)||[]].forEach(n=>l.use(n)),l.hooks.callHook("init",l),l}function J(){return T}export{F as c,J as g};
